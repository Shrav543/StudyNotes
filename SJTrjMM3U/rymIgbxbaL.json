{"_id":"rymIgbxbaL","title":"update profile:","dateCreated":1591963885926,"lastAccessed":"2020-06-12T12:11:25.926Z","lastUpdated":"2020-06-12T12:43:09.239Z","notebookId":"SJTrjMM3U","body":{"blocks":[{"key":"ag6qs","text":"update profile:","type":"header-one","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"dbfnm","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"emt8h","text":"update form will require two models","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"c37cf","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fqk6m","text":"profile model (for image) and user model for username and email","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2j4t6","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"f3n9m","text":"so,","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5orqc","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"8h7lg","text":"in forms.py","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1j7oc","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fucuc","text":"from django.contrib.auth.models import User","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"58r9n","text":"from .models import Profile","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2066i","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ep5vg","text":"class UserUpdateForm(forms.ModelForm): #modelForm allows us interact with particular database model","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"eo4h7","text":"    email = forms.EmailField()","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2scf4","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1eapp","text":"    class Meta:","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"29bi4","text":"        model = User","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"7dhoh","text":"        fields = ['username', 'email']","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5kpme","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"f7uj1","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5vngc","text":"class ProfileUpdateForm(forms.ModelForm):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"6p0bj","text":"    class Meta:","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5e3s8","text":"        model = Profile","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"7qfko","text":"        fields = ['image']","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"59kd9","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"f3j4r","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"djj7b","text":"now lets create integrate these forms in views      ","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"k4fq","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"eftro","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"9d06d","text":"@login_required","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"3llk2","text":"def profile(request):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"18qmr","text":"#TO POPULATE THE FORM WITH USER INFO give the instance argument with current user instance","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"d6uak","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"8d3ot","text":"    if request.method == 'POST':","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"f7337","text":"        u_form = UserUpdateForm(request.POST , instance=request.user) #request.POST is for the post data that user typed","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"c6jbp","text":"        p_form = ProfileUpdateForm(request.POST, request.FILES, instance=request.user.profile) #request.FILES is for the files user uploads","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"agimm","text":"        ","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"e24oi","text":"        if u_form.is_valid() and p_form.is_valid():","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5a9t4","text":"            u_form.save()","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fp1ut","text":"            p_form.save()","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"cjh9f","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"av206","text":"            messages.success(request, f'Your account has been update!')","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"v81q","text":"            return redirect('profile') #we dont want to relaod the page           ","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"36hpv","text":"    else:","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"dh0a3","text":"        u_form = UserUpdateForm(instance=request.user)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"aalnr","text":"        p_form = ProfileUpdateForm(instance=request.user.profile)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1tf8m","text":"        ","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"aajen","text":"        ","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"f7jkc","text":"        context = {","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"4vdm5","text":"            'u_form':u_form,","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"c1our","text":"            'p_form':p_form","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fukgc","text":"        }","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"6g8u4","text":"    ","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2ecpn","text":"        return render(request,'users/profile.html',context)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"36v93","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"9d8qs","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"83m0u","text":"profile model","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"q91a","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"7suf2","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fc0tv","text":"from django.db import models","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1bub9","text":"from django.contrib.auth.models import User","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"100v0","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fsp31","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"6379r","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"4ngqj","text":"class Profile(models.Model):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"53f56","text":"    user = models.OneToOneField(User, on_delete=models.CASCADE)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"3m1qc","text":"    image = models.ImageField(default='default.jpg', upload_to='profile_pics')","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2va18","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2fo17","text":"    def __str__(self):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2mg28","text":"        return f'{self.user.username} Profile'","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fjcdn","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"aa2c8","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"csobe","text":"if you want to restrict user on the image upload size","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":0,"length":53,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"7rkqn","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"b0rfi","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"58ut5","text":"from django.db import models","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"iom5","text":"from django.contrib.auth.models import User","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"47lib","text":"from PIL import Image","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ag9o","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1bon9","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"9mvm4","text":"class Profile(models.Model):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1abal","text":"    user = models.OneToOneField(User, on_delete=models.CASCADE)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"7cler","text":"    image = models.ImageField(default='default.jpg', upload_to='profile_pics')","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"behuv","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5lce6","text":"    def __str__(self):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2fu6t","text":"        return f'{self.user.username} Profile'","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"6qair","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ec9t0","text":"    def save(self):","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ahbid","text":"        super().save()","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"apmof","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"50ll8","text":"        img = Image.open(self.image.path)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"3u4vp","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"513d7","text":"        if img.height > 300 or img.width > 300:","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2102o","text":"            output_size = (300, 300)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"d4dnd","text":"            img.thumbnail(output_size)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"b8ger","text":"            img.save(self.image.path)","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ce8aj","text":"","type":"custom-code-block-python","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"69jrl","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"d4u5j","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"18o13","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"cdi11","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}}],"entityMap":{}},"tags":[]}
